# 28.安全

如果[Spring Security](https://projects.spring.io/spring-security/)包含在类路径中，那么这个web应用默认即被保护了。Spring Boot依赖于Spring Security的内容协商机制来决定使用`httpBasic`还是`formLogin`。要对web应用添加方法级的安全保护，你也可以通过你想要的配置，添加注解`@EnableGlobalMethodSecurity`即可。其他信息可以在[Spring Security参考指南](https://docs.spring.io/spring-security/site/docs/5.0.7.RELEASE/reference/htmlsingle#jc-method)中查看到。

默认的`UserDetailService`只有一个单用户。用户名为`user`,密码是随机的并且会在应用启动时以INFO级别打印出来，例如：

```java
Using generated security password: 78fa095d-3f4c-48b1-ad50-e24c31d5cf35
```

> **注意**
> 
> 如果你微调过日志配置，请确保`org.springframework.boot.autoconfigure.security`目录被设置为`INFO`级别消息。否则，默认的密码不会打印出来。

你可以通过设置`spring.security.user.name`和`spring.security.user.password`来更改用户名密码。

在web应用中默认你能获取的基本功能有：

- 一个以内存存储的`UserDetailService`类(或`ReactiveUserDetailService`类，如果是一个WebFlux应用的话)，并且有一个生成了密码的单一用户(用户的属性值为`SecurityProperties.User`)。
- 在整个应用体(如果执行器处于类路径，则包括执行器端点)中，基于表单的登陆验证或基于HTTP基本安全策略(依赖于Contenty-Type内容类型)
- 一个`DefaultAuthenticationEventPublisher`类用于发布认证事件

你可以为它添加一个自定义实现类，来提供区别于`AuthenticationEventPublisher`的不同功能。

## 28.1 MVC Security

默认的安全配置实现类是在`SecurityAutoConfiguration`和`UserDetailsServiceAutoConfiguration`中。`SecurityAutoConfiguration`类引入了`SpringBootWebSecurityConfiguration`类，作为web安全配置，`UserDetailsServiceAutoConfiguration`配置认证，这在非web应用程序中也是相关的。如果要完全关闭默认的web应用安全配置项，你可以添加一个类型为`WebSecurityConfigurerAdapter`的类来实现(这样做不会禁止`UserDetailService`配置或执行器安全配置)

如果还要关闭`UserDetailService`配置的话，你可以听过添加类型为`UserDetailService`,`AuthenticationProvider`,或`AuthenticationManager`的类。这里有一些样例项目在[Spring Boot样例](https://github.com/spring-projects/spring-boot/tree/v2.0.4.RELEASE/spring-boot-samples/)，让你能够以常见用例形式上手。

通过添加自定义的`WebSecurityConfigurerAdapter`类，能够改写访问规则。Spring Boot提供了一些便捷的方法来覆写执行器端点和静态资源的访问规则。我们能使用`EndpointRequest`类来创建`RequestMatacher`类，这个类是基于`management.endpoints.web.base-path`属性的。我们能使用`PathRequest`类来创建`RequestMatcher`类，来处理常用的资源地址。













































