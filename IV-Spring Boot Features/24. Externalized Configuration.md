# 24 外部配置

Spring Boot允许你通过外部化配置，来实现在不同环境中开发同一个应用程序你可以使用属性文件，YAML文件，环境变量和命令行参数来实现外部配置。可以通过Spring的环境抽象访问，将`@Value`注解直接注入属性值，或者通过`ConfigurationProperties`来[绑定到结构化对象上]()

Spring Boot使用一个特殊设计的`PropertySource`顺序，来接收属性值覆写。属性值会按照如下顺序：


1. home目录(devtools激活时候~/.spring-boot-devtools.properties)下的[Devtools的全局配置属性]()

2. 测试中的[@TestPropertySource]()注解.

3. 注解中的[@SpringBootTest#properties]()注解属性.

4. 命令行参数

5. `SPRING_APPLICATION_JSON`(嵌入在环境变量或系统属性中的内联JSON)中的属性
 
6. ServletConfig初始化参数.

7. ServletContext初始化参数.

8. `java:comp/env`下的JNDI属性.

9. Java系统属性 (`System.getProperties()`).

10. 系统环境变量.

11. 只存在于`random.*`的`RandomValuePropertySource`属性.

12. jar包之外的指定配置文件的应用属性(application-{profile}.properties和YAML变量)

13. jar包之内的指定配置文件的应用属性(application-{profile}.properties和YAML变量)

14. jar包之外的应用属性 (application.properties和YAML变量).

15. jar包之内的应用属性 (application.properties和YAML变量).

16. @Configuration类中的@PropertySource注解.

17. 默认属性(通过SpringApplication.setDefaultProperties指定).

为提供一个具体的例子，假设你开发了一个`@Component`组件并使用了`name`属性，样例代码如下所示：

```java
import org.springframework.stereotype.*
import org.springframework.beans.factory.annotation.*
@Component
public class MyBean { 
	@Value("${name}")
	private String name;
// ...
}
```

在你的应用classpath中(例如，在你的jar包中)你可以使用`application.properties`文件来提供`name`的默认值。当运行在一个新环境中时，jar包能够使用一个新的`application.properties`文件来覆写`name`值。对于一次性测试，你可以通过特定的命令行开关(例如`java -jar app.jar --name="Spring"`)来启动。

> **小贴士**
> 
> `SPRING_APPLICATION_JSON`属性集能够通过带有环境变量的命令行来提供使用。例如，你可以在UN*X shell中使用以下命令：
> 
> ```bash
> $ SPRING_APPLICATION_JSON='{"acme":{"name":"test"}}' java -jar myapp.jar
> ```
> 
> 在之前的例子中，Spring环境中使用`acme.name=test`来结尾。你也可以通过使用`spring.application.json`作为系统属性传递，样例代码如下所示：
> 
> ```bash
> $ java -Dspring.application.json='{"name":"test"}' -jar myapp.jar
> ```
> 
> 你也可以通过提供命令行参数JSON，样例代码如下所示：
> 
> ```bash
> $ java -jar myapp.jar --spring.application.json='{"name":"test"}'
> ```
> 
> 你可以提供JSON和JNDI变量，例如：`java:comp/env/`







































